<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WSG MOOC Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .nav { 
      margin-bottom: 20px; 
      padding: 15px 20px; 
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .nav a { 
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    
    .nav a:hover { 
      background: #f0f4ff;
    }
    
    .page-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      min-height: 500px;
    }
    
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.3s; }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    h1 { color: #2c3e50; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 25px; font-size: 2em; }
    h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; font-size: 1.5em; }
    h3 { color: #555; margin-top: 20px; margin-bottom: 10px; font-size: 1.2em; }
    h4 { color: #666; margin-top: 15px; margin-bottom: 8px; font-size: 1.1em; }
    
    p { margin-bottom: 15px; line-height: 1.8; }
    
    ul, ol { margin-left: 25px; margin-bottom: 15px; }
    li { margin-bottom: 8px; line-height: 1.7; }
    
    a { color: #667eea; text-decoration: none; }
    a:hover { text-decoration: underline; }
    
    blockquote { 
      border-left: 4px solid #667eea; 
      margin: 15px 0; 
      padding-left: 20px; 
      color: #666;
      background: #f8f9fa;
      padding: 15px 20px;
      border-radius: 4px;
      font-style: italic;
    }
    
    code { 
      background: #f4f4f4; 
      padding: 2px 6px; 
      border-radius: 3px; 
      font-family: 'Courier New', monospace;
    }
    
    pre { 
      background: #2c3e50; 
      color: #ecf0f1;
      padding: 15px; 
      border-radius: 4px;
      overflow-x: auto;
      margin-bottom: 15px;
      line-height: 1.4;
    }
    
    .quiz-option {
      display: flex;
      align-items: center;
      margin: 12px 0;
      padding: 10px;
      border-radius: 4px;
      background: #f8f9fa;
      cursor: pointer;
    }
    
    .quiz-option input {
      margin-right: 12px;
      cursor: pointer;
      width: 18px;
      height: 18px;
    }
    
    .quiz-option:hover {
      background: #e8f0ff;
    }
    
    .feedback {
      margin-top: 10px;
      padding: 10px;
      border-left: 4px solid #27ae60;
      background: #f0fff4;
      color: #27ae60;
      display: none;
    }
    
    .text-input {
      width: 100%;
      min-height: 60px;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 1em;
      margin: 10px 0;
    }
    
    .text-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-top: 40px;
      justify-content: space-between;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1em;
    }
    
    .btn-prev {
      background: #ecf0f1;
      color: #34495e;
    }
    
    .btn-prev:hover {
      background: #bdc3c7;
    }
    
    .btn-next {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-next:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-prev:disabled, .btn-next:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .page-counter {
      color: #999;
      font-size: 0.9em;
    }
    
    .loading { text-align: center; padding: 50px; color: #888; }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav">
      <a href="viewer.html">üè† Home</a>
      <a href="viewer.html?course=Front-end_Developer.md">üíª Front-end</a>
      <a href="viewer.html?course=UX_Designer.md">üé® UX</a>
      <a href="viewer.html?course=Visual_Designer.md">üëÅÔ∏è Visual</a>
      <a href="viewer.html?course=Content_Author.md">‚úçÔ∏è Content</a>
    </div>
    
    <div class="page-container">
      <div id="content" class="loading">Loading course content...</div>
      <div class="controls" id="controls" style="display: none;">
        <button class="btn-prev" id="prevBtn" onclick="prevPage()">‚Üê Previous</button>
        <span class="page-counter"><span id="currentPage">1</span> / <span id="totalPages">1</span></span>
        <button class="btn-next" id="nextBtn" onclick="nextPage()">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <script>
    let pages = [];
    let currentPage = 0;
    
    function markdownToHtml(markdown) {
      return markdown
        // Convert headers
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        // Convert quiz checkboxes [[x] and [ ]]
        .replace(/\[x\] ([^\n]+)/g, (match, text) => {
          return `<div class="quiz-option"><input type="radio" checked disabled> ${escapeHtml(text)}</div>`;
        })
        .replace(/\[ \] ([^\n]+)/g, (match, text) => {
          return `<div class="quiz-option"><input type="radio" disabled> ${escapeHtml(text)}</div>`;
        })
        // Convert text inputs
        .replace(/\[\[___\]\]/g, '<textarea class="text-input" placeholder="Your response here..."></textarea>')
        // Convert bold
        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
        // Convert italic
        .replace(/\*([^*]+)\*/g, '<em>$1</em>')
        // Convert links
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, (match, text, url) => {
          if (url.endsWith('.md')) {
            return `<a href="viewer.html?course=${encodeURIComponent(url)}">${escapeHtml(text)}</a>`;
          }
          return `<a href="${escapeHtml(url)}" target="_blank">${escapeHtml(text)}</a>`;
        })
        // Convert code blocks
        .replace(/```[\s\S]*?```/g, (match) => {
          const code = match.replace(/```/g, '').trim();
          return `<pre><code>${escapeHtml(code)}</code></pre>`;
        })
        // Convert inline code
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        // Convert blockquotes
        .replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>')
        // Convert bullet lists
        .replace(/^\* (.*$)/gim, '<li>$1</li>')
        .replace(/^- (.*$)/gim, '<li>$1</li>')
        // Convert numbered lists
        .replace(/^\d+\. (.*$)/gim, '<li>$1</li>')
        // Wrap lists
        .replace(/(<li>[\s\S]*?<\/li>)/s, '<ul>$1</ul>')
        // Remove multiple list wrappers
        .replace(/<\/ul>\s*<ul>/g, '')
        // Convert line breaks
        .replace(/\n\n+/g, '</p><p>')
        .replace(/\n/g, '<br>');
    }
    
    function escapeHtml(text) {
      const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
      return text.replace(/[&<>"']/g, m => map[m]);
    }
    
    function splitPages(markdown) {
      // Remove LiaScript frontmatter
      markdown = markdown.replace(/<!--[\s\S]*?-->/g, '').trim();
      
      // Split on page breaks (---)
      return markdown.split(/\n---\n/).map(page => page.trim()).filter(p => p.length > 0);
    }
    
    function renderPage(pageNum) {
      if (pageNum < 0 || pageNum >= pages.length) return;
      
      currentPage = pageNum;
      const html = markdownToHtml(pages[pageNum]);
      document.getElementById('content').innerHTML = html;
      
      // Update controls
      document.getElementById('currentPage').textContent = currentPage + 1;
      document.getElementById('totalPages').textContent = pages.length;
      document.getElementById('prevBtn').disabled = currentPage === 0;
      document.getElementById('nextBtn').disabled = currentPage === pages.length - 1;
    }
    
    function nextPage() {
      if (currentPage < pages.length - 1) {
        renderPage(currentPage + 1);
        window.scrollTo(0, 0);
      }
    }
    
    function prevPage() {
      if (currentPage > 0) {
        renderPage(currentPage - 1);
        window.scrollTo(0, 0);
      }
    }
    
    // Load course
    const params = new URLSearchParams(window.location.search);
    const course = params.get('course') || 'Home.md';
    
    fetch(course)
      .then(response => {
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return response.text();
      })
      .then(markdown => {
        pages = splitPages(markdown);
        
        if (pages.length === 0) {
          document.getElementById('content').innerHTML = '<p>No content found.</p>';
          return;
        }
        
        document.getElementById('controls').style.display = 'flex';
        renderPage(0);
      })
      .catch(error => {
        document.getElementById('content').innerHTML = 
          '<p style="color: red;"><strong>Error loading course:</strong> ' + escapeHtml(error.message) + 
          '</p><p>Make sure you are running: <code>python3 -m http.server 8020 --directory liascript_courses</code></p>';
      });
  </script>
</body>
</html>
